# Matrix ESS Community 域名配置说明

## 🌐 域名架构设计

### 标准子域名前缀
基于主域名自动生成标准化的子域名结构：

| 服务 | 子域名前缀 | 完整域名示例 | 用途 |
|------|------------|--------------|------|
| Element Web | `app` | `app.example.com` | Web客户端界面 |
| 认证服务 | `mas` | `mas.example.com` | Matrix Authentication Service |
| RTC服务 | `rtc` | `rtc.example.com` | 视频会议服务 |
| Matrix服务器 | `matrix` | `matrix.example.com` | Synapse主服务器 |
| IP解析 | `ip` | `ip.example.com` | 公网IP DDNS解析 |

## 📋 配置流程

### 1. 主域名输入
```bash
主域名 (如: example.com): your-domain.com
```

### 2. 自动生成子域名
脚本会自动生成所有必需的子域名：
```bash
基于主域名 your-domain.com 自动生成子域名:
  Element Web: app.your-domain.com
  认证服务 (MAS): mas.your-domain.com
  RTC服务: rtc.your-domain.com
  Matrix服务器: matrix.your-domain.com
  Synapse: matrix.your-domain.com
```

### 3. 确认或自定义
- **默认选择**: 使用自动生成的标准域名
- **自定义选择**: 手动输入每个服务的域名

## 🔧 DNS配置要求

### 必需的DNS记录
假设主域名为 `example.com`，需要配置以下A记录：

```dns
# 公网IP解析 (DDNS)
ip.example.com      A    123.456.789.123

# 服务域名
app.example.com     A    123.456.789.123  # Element Web
mas.example.com     A    123.456.789.123  # 认证服务
rtc.example.com     A    123.456.789.123  # RTC服务
matrix.example.com  A    123.456.789.123  # Matrix服务器
```

### DDNS配置
- **IP解析域名**: `ip.your-domain.com` 必须配置DDNS自动更新
- **服务域名**: 可以指向固定IP或使用CNAME指向IP解析域名

## 🎯 设计优势

### 1. 标准化命名
- **app**: 直观表示应用客户端
- **mas**: Matrix Authentication Service的标准缩写
- **rtc**: Real-Time Communication的标准缩写
- **matrix**: Matrix协议的标准服务器标识

### 2. 易于管理
- 基于单一主域名管理所有子域名
- 标准化前缀便于记忆和配置
- 支持批量DNS配置

### 3. 扩展性好
- 预留标准前缀便于未来扩展
- 兼容Matrix生态系统标准
- 支持多环境部署

## 📖 配置示例

### 示例1: 个人域名
```bash
主域名: mymatrix.com

生成的域名:
- Element Web: app.mymatrix.com
- 认证服务: mas.mymatrix.com  
- RTC服务: rtc.mymatrix.com
- Matrix服务器: matrix.mymatrix.com
```

### 示例2: 企业域名
```bash
主域名: company.com

生成的域名:
- Element Web: app.company.com
- 认证服务: mas.company.com
- RTC服务: rtc.company.com
- Matrix服务器: matrix.company.com
```

### 示例3: 子域名部署
```bash
主域名: matrix.company.com

生成的域名:
- Element Web: app.matrix.company.com
- 认证服务: mas.matrix.company.com
- RTC服务: rtc.matrix.company.com
- Matrix服务器: matrix.matrix.company.com
```

## 🔍 验证方法

### DNS解析测试
```bash
# 测试所有域名解析
dig app.your-domain.com @8.8.8.8
dig mas.your-domain.com @8.8.8.8
dig rtc.your-domain.com @8.8.8.8
dig matrix.your-domain.com @8.8.8.8
dig ip.your-domain.com @8.8.8.8
```

### 批量测试脚本
```bash
#!/bin/bash
DOMAIN="your-domain.com"
SUBDOMAINS=("app" "mas" "rtc" "matrix" "ip")

for sub in "${SUBDOMAINS[@]}"; do
    echo "测试 $sub.$DOMAIN:"
    dig +short $sub.$DOMAIN @8.8.8.8
done
```

## ⚠️ 注意事项

### 1. DNS传播时间
- 新增DNS记录可能需要几分钟到几小时传播
- 建议提前配置DNS记录

### 2. 证书申请
- 所有子域名都需要SSL证书
- 建议使用通配符证书 `*.your-domain.com`

### 3. 防火墙配置
- 确保所有子域名都指向正确的服务器IP
- 配置相应的端口映射

## 🛠️ 故障排除

### 域名解析失败
1. 检查DNS记录配置
2. 验证域名服务商设置
3. 测试DNS传播状态
4. 确认防火墙规则

### DDNS更新失败
1. 检查DDNS服务配置
2. 验证API密钥设置
3. 测试网络连通性
4. 查看DDNS服务日志

---

**更新时间**: 2025-06-13  
**适用版本**: Matrix ESS Community v5.0.0  
**域名标准**: app/mas/rtc/matrix 标准前缀
